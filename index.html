<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>캡스톤 프로젝트 소개: 루틴팜</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 커스텀 스타일 및 폰트 설정 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f7f7f7;
        }
        .sidebar {
            background-color: #e6f3ff; /* 배경색: 밝은 파란색 계열 */
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .nav-link {
            transition: all 0.2s ease;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #1e40af; /* 짙은 파란색 텍스트 */
            font-weight: 500;
        }
        .nav-link:hover {
            background-color: #cce0ff;
        }
        .nav-link.active {
            background-color: #3b82f6; /* 활성 링크 배경색 */
            color: white;
            font-weight: 700;
        }
        .content-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        h1, h2, h3 {
            color: #1e40af;
        }
    </style>
</head>
<body class="flex min-h-screen">

    <!-- 사이드바 (Nav) -->
    <aside class="sidebar w-64 p-6 sticky top-0 h-screen hidden md:block">
        <h1 class="text-2xl font-bold mb-8 border-b pb-4 text-gray-800">
            캡스톤 프로젝트 소개
        </h1>
        <nav id="nav-container" class="space-y-2">
            <!-- Navigation links will be dynamically loaded here -->
        </nav>

        <div class="mt-10 pt-4 border-t border-blue-200">
            <h3 class="text-lg font-semibold mb-2 text-gray-700">API Endpoints</h3>
            <div id="api-list" class="text-sm space-y-1 text-gray-600">
                <!-- API links will be dynamically loaded here -->
            </div>
        </div>
    </aside>

    <!-- 메인 콘텐츠 영역 -->
    <main class="flex-1 p-6 md:p-10">
        <div id="content-area" class="content-card p-8 md:p-12">
            <!-- Content will be dynamically rendered here -->
            <div class="text-center py-20">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                <p class="mt-4 text-gray-500">데이터를 불러오는 중입니다...</p>
            </div>
        </div>
    </main>

    <script>
        const API_BASE_URL = window.location.origin;

        // URL 경로에 따라 렌더링할 페이지 이름 결정
        function getCurrentPageKey() {
            // 예: /subject -> subject
            const path = window.location.pathname.split('/').filter(p => p.length > 0);
            return path.length > 0 && path[0] !== 'index.html' ? path[0] : 'main';
        }

        // 페이지 내용을 동적으로 렌더링하는 함수
        function renderContent(pageKey, data) {
            const contentArea = document.getElementById('content-area');
            let html = '';
            
            // 메인 페이지 렌더링
            if (pageKey === 'main') {
                html = `
                    <h2 class="text-4xl font-extrabold mb-4">${data.project_title}</h2>
                    <p class="text-xl text-gray-600 mb-10">본 저장소는 캡스톤 프로젝트 단일 소개 페이지와 API를 제공합니다.</p>
                    
                    <div class="grid md:grid-cols-2 gap-6 text-lg">
                        ${Object.keys(data.sections).map(key => {
                            const section = data.sections[key];
                            return `
                                <a href="${section.path}" class="block p-4 border border-blue-200 rounded-lg hover:bg-blue-50 transition duration-150">
                                    <h3 class="text-2xl font-semibold text-blue-800 mb-2">${section.title}</h3>
                                    <p class="text-gray-500">자세한 내용 보기 &rarr;</p>
                                </a>
                            `;
                        }).join('')}
                    </div>

                    <div class="mt-12 p-6 border-t border-gray-200">
                        <h3 class="text-xl font-semibold mb-3 text-gray-700">실행 방법 (Run)</h3>
                        <p class="text-gray-700 mb-2">로컬 또는 EC2/ECS 환경에서 Docker Compose를 사용하여 실행합니다.</p>
                        <pre class="bg-gray-100 p-3 rounded-lg text-sm overflow-x-auto"><code class="text-red-600 font-mono">docker compose up --build -d</code></pre>
                        <p class="mt-2 text-gray-700">접속 주소: <code>http://localhost:5000</code> 또는 배포된 Public IP</p>
                    </div>
                `;
            } 
            // 상세 페이지 렌더링
            else {
                const sectionData = data.data;
                const title = data.title_ko;
                
                html += `<h2 class="text-3xl font-bold mb-6 border-b pb-3">${title}</h2>`;

                if (pageKey === 'subject') {
                    html += `<div class="space-y-4">
                        <h3 class="text-2xl font-semibold text-gray-800">${sectionData['제목']}</h3>
                        <p class="text-lg text-gray-600 border-l-4 border-blue-500 pl-4 py-2">${sectionData['요약']}</p>
                    </div>`;
                } else if (pageKey === 'rationale') {
                    html += `
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-2">문제 인식</h3>
                            <p class="text-lg text-gray-700">${sectionData['문제']}</p>
                        </div>
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-2">근거 (수치/설문/사례)</h3>
                            <ul class="list-disc list-inside space-y-1 pl-4 text-gray-700">
                                ${sectionData['근거'].map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-2">기대 가치</h3>
                            <p class="text-lg text-green-700">${sectionData['기대_가치']}</p>
                        </div>
                    `;
                } else if (pageKey === 'features') {
                    html += `<div class="space-y-8">
                        ${sectionData.map((feature, index) => `
                            <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                                <h4 class="text-xl font-bold text-blue-700 mb-2">기능 ${index + 1}: ${feature['기능명']}</h4>
                                <ul class="list-disc list-inside space-y-1 pl-4 text-gray-600">
                                    ${feature['설명'].map(desc => `<li>${desc}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>`;
                } else if (pageKey === 'environment') {
                    html += `<div class="space-y-4 text-lg">
                        ${Object.keys(sectionData).map(key => `
                            <p><strong>${key}</strong>: <span class="text-gray-700">${sectionData[key]}</span></p>
                        `).join('')}
                    </div>`;
                } else if (pageKey === 'team') {
                     html += `<div class="space-y-4">
                        ${sectionData.map(member => `
                            <div class="p-3 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg">
                                <p class="text-lg font-semibold">${member['이름']}</p>
                                <p class="text-gray-600 text-sm">${member['역할']}</p>
                            </div>
                        `).join('')}
                    </div>`;
                }

                // 홈으로 돌아가기 버튼
                html += `<div class="mt-8 pt-4 border-t text-right">
                    <a href="/" class="text-blue-500 hover:text-blue-700 font-medium transition duration-150">
                        &larr; 홈으로
                    </a>
                </div>`;
            }

            contentArea.innerHTML = html;
        }

        // 페이지 로드 및 데이터 가져오기
        async function loadDataAndRender() {
            const pageKey = getCurrentPageKey();
            const apiPath = pageKey === 'main' ? '/api/main' : `/api/${pageKey}`;
            
            try {
                const response = await fetch(API_BASE_URL + apiPath);
                if (!response.ok) throw new Error('API 응답 오류');
                const data = await response.json();
                
                // 네비게이션 및 API 목록 렌더링 (메인 정보가 필요)
                const mainResponse = await fetch(API_BASE_URL + '/api/main');
                const mainData = await mainResponse.json();
                renderNavigation(mainData, pageKey);

                renderContent(pageKey, data);
            } catch (error) {
                console.error("데이터 로드 실패:", error);
                document.getElementById('content-area').innerHTML = `
                    <div class="text-center py-20 text-red-500">
                        <h2 class="text-3xl font-bold mb-4">데이터 로드 실패</h2>
                        <p>백엔드 API 서버(${API_BASE_URL}${apiPath})와의 통신에 문제가 발생했습니다.</p>
                        <p class="mt-4">콘솔 로그를 확인해주세요.</p>
                    </div>
                `;
            }
        }

        // 네비게이션 링크 및 API 엔드포인트 목록을 렌더링하는 함수
        function renderNavigation(mainData, currentPageKey) {
            const navContainer = document.getElementById('nav-container');
            const apiList = document.getElementById('api-list');
            
            let navHtml = '';
            
            // 1. 메인 페이지 링크 추가
            navHtml += `<a href="/" class="nav-link ${currentPageKey === 'main' ? 'active' : ''}">메인 페이지</a>`;

            // 2. 기타 섹션 링크 추가
            Object.keys(mainData.sections).forEach(key => {
                const section = mainData.sections[key];
                navHtml += `<a href="${section.path}" class="nav-link ${key === currentPageKey ? 'active' : ''}">
                    ${section.title}
                </a>`;
            });
            
            navContainer.innerHTML = navHtml;

            // 3. API 엔드포인트 목록 추가
            apiList.innerHTML = mainData.api_endpoints.map(endpoint => `
                <a href="${API_BASE_URL}${endpoint}" target="_blank" class="block text-blue-500 hover:text-blue-700 hover:underline">
                    ${endpoint}
                </a>
            `).join('');
            // main API 엔드포인트 추가
            apiList.innerHTML += `<a href="${API_BASE_URL}/api/main" target="_blank" class="block text-blue-500 hover:text-blue-700 hover:underline">/api/main</a>`;

        }


        // 브라우저 뒤로/앞으로 가기 버튼을 눌렀을 때도 페이지를 다시 렌더링
        window.onpopstate = loadDataAndRender;

        // 초기 로드
        window.onload = loadDataAndRender;
    </script>
</body>
</html>